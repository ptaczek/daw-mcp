# E2E Test Results - 2026-01-01

## Environment
- **Tester:** Claude (Opus 4.5)
- **Platform:** Linux 6.8.0-90-generic
- **Bitwig:** MCP-Test-Bitwig project
- **Ableton:** MCP-Test-Ableton project (Wine/Lutris)

## Summary

| Phase | Tests | Passed | Failed | Notes |
|-------|-------|--------|--------|-------|
| 1. Discovery & Connection | 4 | 4 | 0 | All connection states verified |
| 2. Project & Track Operations | 5 | 5 | 0 | `createdIndices` returns empty array |
| 3. Clip Operations | 7 | 7 | 0 | |
| 4. Note Operations | 10 | 10 | 0 | |
| 5. Euclidean Patterns | 3 | 3 | 0 | Both DAWs tested |
| 6. Cross-DAW Operations | 4 | 4 | 0 | |
| 7. Error Handling | 3 | 3 | 0 | |
| **Total** | **36** | **36** | **0** | **100% pass rate** |

## Detailed Results

### Phase 1: Discovery & Connection (4/4 PASSED)
- Test 1.1: No DAW Connected - PASSED
- Test 1.2: Single DAW (Bitwig) - PASSED
- Test 1.3: Single DAW (Ableton) - PASSED
- Test 1.4: Both DAWs Connected - PASSED

### Phase 2: Project & Track Operations (5/5 PASSED)
- Test 2.1: Get Project Info - PASSED
- Test 2.2: List Tracks - PASSED
- Test 2.3: Create Tracks - PASSED (note: `createdIndices` returns empty array)
- Test 2.4: Set Track Properties - PASSED
- Test 2.5: Delete Tracks - PASSED

### Phase 3: Clip Operations (7/7 PASSED)
- Test 3.1: Create Clip (Auto-find) - PASSED
- Test 3.2: Create Clip (Specific Slot) - PASSED
- Test 3.3: Create Clip (Occupied Slot) - PASSED (correctly failed)
- Test 3.4: Create Clip (Overwrite) - PASSED
- Test 3.5: List Clips - PASSED
- Test 3.6: Set Clip Length - PASSED
- Test 3.7: Delete Clip - PASSED

### Phase 4: Note Operations (10/10 PASSED)
- Test 4.1: Set Notes (Lean Array) - PASSED
- Test 4.2: Get Notes (Lean Format) - PASSED
- Test 4.3: Get Notes (Verbose) - PASSED
- Test 4.4: Get Clip Stats - PASSED
- Test 4.5: Move Notes - PASSED
- Test 4.6: Set Note Properties - PASSED
- Test 4.7: Transpose Clip - PASSED
- Test 4.8: Transpose Range - PASSED
- Test 4.9: Clear Specific Notes - PASSED
- Test 4.10: Clear All Notes - PASSED

### Phase 5: Euclidean Patterns (3/3 PASSED)
- Test 5.1: Create Euclidean Pattern (Bitwig) - PASSED
- Test 5.2: Add to Existing Clip - PASSED
- Test 5.3: Create Euclidean Pattern (Ableton) - PASSED

### Phase 6: Cross-DAW Operations (4/4 PASSED)
- Test 6.1: Explicit DAW Selection (Bitwig) - PASSED
- Test 6.2: Explicit DAW Selection (Ableton) - PASSED
- Test 6.3: Create Clip in Non-Default DAW - PASSED
- Test 6.4: Auto-Selection with Single DAW - PASSED

### Phase 7: Error Handling (3/3 PASSED)
- Test 7.1: No DAW Connected - PASSED
- Test 7.2: Invalid Track Index - PASSED (returns "Invalid params: Track does not exist")
- Test 7.3: No Clip Selected - PASSED

## Bugs Found & Fixed

### 1. Explicit trackIndex/slotIndex fails after DAW reopen (FIXED)
**Symptom:** `batch_create_clips` with explicit `trackIndex/slotIndex` returned "No clip slot selected" even when valid indices were provided.
**Root cause:** MCP server always queried cursor position first, even when explicit indices were provided. When no slot was selected in Bitwig, this failed before processing the explicit indices.
**Fix:** Lazy cursor fetching via `ensureCursor()` - Mode B (explicit indices) now skips cursor query entirely.
**Commit:** `5e3da3b`

### 2. Error handling misclassified parameter errors as "Method not found" (FIXED)
**Symptom:** `batch_list_clips` on track 99 returned "Method not found: clip.list" instead of proper validation error.
**Root cause:** `MCPServer.java` caught all `IllegalArgumentException`s and returned "Method not found", even for parameter validation errors like "Track does not exist".
**Fix:** Distinguish between method-not-found errors (pattern: "Unknown * action:", "Unknown category:") and parameter validation errors. The latter now return "Invalid params: <message>".

### 3. No track index validation in set operations (FIXED)
**Symptom:** `batch_set_track_properties` on track 99 (non-existent) returned success instead of an error.
**Root cause:** `setMute`, `setVolume`, etc. in `TrackHandler.java` didn't validate track existence before setting properties.
**Fix:** Added `getValidatedTrack(index)` helper that checks `track.exists().get()` and throws if track doesn't exist. All set* methods now use this helper.

### 4. `createdIndices` empty in batch_create_tracks (DEFERRED)
**Symptom:** When creating tracks, the response includes `createdIndices: []` instead of actual indices.
**Status:** Low priority - Bitwig's `createInstrumentTrack()` doesn't return the created index. Would require polling or observer pattern to detect new track.

## Build Improvements

- **Version from package.json:** Gradle now reads version from `mcp-server/package.json` as single source of truth
- **Platform-aware paths:** `copyExtension` task detects OS:
  - Windows/macOS: `~/Documents/Bitwig Studio/Extensions`
  - Linux: `~/Bitwig Studio/Extensions`
